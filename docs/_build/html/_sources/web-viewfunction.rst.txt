.. _web-viewfunction:

视图函数说明
===============

此部分文档简要介绍顶点云 Web 服务器提供的视图函数，将按 :ref:`web-blueprint-auth` 和 :ref:`web-blueprint-main` 分成两个部分。

.. _web-viewfunction-auth:

Auth 蓝本视图函数
---------------------

此部分视图函数来自 :ref:`web-blueprint-auth` ，位于文件 `web/app/auth/views.py` 中。共包含如下视图函数：

+--------------------------+---------------------------------------------------------------------------+
| 视图函数名               | 功能                                                                      |
+==========================+===========================================================================+
| `rules`                  | 提供了 “注册须知” 界面的入口                                              |
+--------------------------+---------------------------------------------------------------------------+
| `login`                  | 提供了登录界面入口                                                        |
+--------------------------+---------------------------------------------------------------------------+
| `logout`                 | 提供了登出操作，登出后默认重定向到登陆入口                                |
+--------------------------+---------------------------------------------------------------------------+
| `register`               | 提供了注册入口                                                            |  
+--------------------------+---------------------------------------------------------------------------+
| `confirm`                | 提供了用户注册邮箱激活入口，根据激活链接尾部的 `token` 校验用户是否合法   | 
+--------------------------+---------------------------------------------------------------------------+
| `resend_confirmation`    | 用于在用户未收到激活邮件时重发                                            |
+--------------------------+---------------------------------------------------------------------------+
| `change_password`        | 为用户修改密码的视图函数                                                  |
+--------------------------+---------------------------------------------------------------------------+
| `change_email_request`   | 为用户重置邮箱请求入口                                                    |
+--------------------------+---------------------------------------------------------------------------+
| `change_email`           | 用于验证用户重置邮箱后的激活链接                                          |
+--------------------------+---------------------------------------------------------------------------+
| `password_reset_request` | 为用户重置密码入口                                                        |
+--------------------------+---------------------------------------------------------------------------+
| `password_reset`         | 用于验证用户重置密码请求 token 的合法性                                   |
+--------------------------+---------------------------------------------------------------------------+
| `secure_center`          | 返回安全中心界面                                                          |
+--------------------------+---------------------------------------------------------------------------+
| `before_request`         | 注册了用户未激活邮箱时的跳转接口                                          |
+--------------------------+---------------------------------------------------------------------------+
| `unconfirmed`            | 提供了未验证的界面                                                        |
+--------------------------+---------------------------------------------------------------------------+

.. _web-viewfunction-main:

Main 蓝本视图函数
---------------------

此部分视图函数来自 :ref:`web-blueprint-main` ，位于文件 `web/app/main/views.py` 中。共包含如下视图函数：

+-----------------------------+---------------------------------------------------------------------------+
| 视图函数名                  | 功能                                                                      |
+=============================+===========================================================================+
| `moderate`                  | 提供了 “管理” 界面的入口                                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `home`                      | 提供了顶点云介绍界面的入口                                                |
+-----------------------------+---------------------------------------------------------------------------+
| `index`                     | 服务器主页入口点，将展示用户共享的资源描述                                |
+-----------------------------+---------------------------------------------------------------------------+
| `show_all`                  | 将用户 cookie 中的 show_followed 选项复位                                 |  
+-----------------------------+---------------------------------------------------------------------------+
| `show_followed`             | 将用户 cookie 中的 show_followed 选项置位                                 | 
+-----------------------------+---------------------------------------------------------------------------+
| `user`                      | 服务器用户资料界面入口                                                    |
+-----------------------------+---------------------------------------------------------------------------+
| `edit_profile`              | 为当前已登陆用户提供编辑用户资料入口                                      |
+-----------------------------+---------------------------------------------------------------------------+
| `edit_profile_admin`        | 为具有管理员权限的用户提供编辑任意用户资料的入口                          |
+-----------------------------+---------------------------------------------------------------------------+
| `file`                      | 显示具体的资源信息                                                        |
+-----------------------------+---------------------------------------------------------------------------+
| `follow`                    | 为用户关注其它用户提供了跳板，若关注成功则跳转到被关注用户的资料界面      |
+-----------------------------+---------------------------------------------------------------------------+
| `unfollow`                  | 为用户提供了 follow 的逆操作                                              |
+-----------------------------+---------------------------------------------------------------------------+
| `followers`                 | 显示某用户关注者的界面入口                                                |
+-----------------------------+---------------------------------------------------------------------------+
| `followed_by`               | 显示某用户关注的人的入口                                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `delete_file`               | 提供了删除文件界面的入口                                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `delete_file_confirm`       | 对用户的删除操作进行确认并执行                                            |
+-----------------------------+---------------------------------------------------------------------------+
| `edit_file`                 | 为用户编辑文件信息（重命名、修改描述）界面提供了入口                      |
+-----------------------------+---------------------------------------------------------------------------+
| `moderate_comments`         | 为评论管理员提供了审核、屏蔽评论的界面入口                                |
+-----------------------------+---------------------------------------------------------------------------+
| `moderate_comments_disable` | 为评论管理员提供了将某条评论屏蔽的入口                                    | 
+-----------------------------+---------------------------------------------------------------------------+
| `moderate_comments`         | 为文件所有者提供了管理自己文件下评论的权限                                |
| `_disable_own`              |                                                                           | 
+-----------------------------+---------------------------------------------------------------------------+
| `moderate_files`            | 为管理员提供了修改、删除、设置任意文件状态的入口                          |
+-----------------------------+---------------------------------------------------------------------------+
| `moderate_files_delete`     | 为管理员用户提供了删除文件的入口，管理员也可以通过用户的 `delete_file` 来 |
|                             | 实现此功能，但此方式去掉了认证阶段                                        |
+-----------------------------+---------------------------------------------------------------------------+
| `messages`                  | 用户消息界面的入口                                                        |
+-----------------------------+---------------------------------------------------------------------------+
| `cloud`                     | 提供了“我的云盘”界面入口                                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `view_share_folder_entry`   | 提供了用户访问其他用户共享目录的认证入口                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `view_do`                   | 为用户提供了访问其他用户共享目录的界面                                    |
+-----------------------------+---------------------------------------------------------------------------+
| `download`                  | 为设有分享密码的文件/目录提供了验证界面，否则直接跳转到 `download_do` 入口|
+-----------------------------+---------------------------------------------------------------------------+
| `download_do`               | 验证用户的下载请求是否合法，传入的 token 将由当前用户进行解析，若失败则返 |
|                             | 回 403 错误；若成功则根据用户请求反馈数据，当用户试图下载的是目录时，会先 |
|                             | 将目录压缩为压缩包后反馈给用户，否则直接返回文件                          |
+-----------------------------+---------------------------------------------------------------------------+
| `upload`                    | 为用户上传文件界面提供入口                                                |
+-----------------------------+---------------------------------------------------------------------------+
| `copy`                      | 为用户复制文件/目录界面提供了入口                                         |
+-----------------------------+---------------------------------------------------------------------------+
| `copy_check`                | 验证用户复制操作的入口，当前用户根据传入的 token 验证合法性并向数据库执行 |
|                             | 写入操作。若用户要复制的是目录，则 copy_check 会将待复制目录下所有关联文件|
|                             | 一起拷贝                                                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `move`                      | 为用户移动文件/目录界面提供了入口                                         |
+-----------------------------+---------------------------------------------------------------------------+
| `move_check`                | 验证用户移动操作的入口，当前用户根据传入的 token 验证合法性并向数据库执行 |
|                             | 写入操作。若用户要移动的是目录，则 fork_check 会将待移动目录下所有关联文件|
|                             | 一起移动                                                                  |
+-----------------------------+---------------------------------------------------------------------------+
| `fork`                      | 提供了一个简单的验证界面，用户需要输入要 fork 的文件/目录的提取码         |
+-----------------------------+---------------------------------------------------------------------------+
| `fork_do`                   | 为用户 Fork 文件/目录界面提供了入口                                       |
+-----------------------------+---------------------------------------------------------------------------+
| `fork_check`                | fork_check 是验证用户 Fork 操作的入口，当前用户根据传入的 token 验证合法  |
|                             | 性并向数据库执行写入操作。若用户要 Fork 的是目录，则 fork_check 会将待    |
|                             | Fork 目录下所有关联文件一起 Fork                                          |
+-----------------------------+---------------------------------------------------------------------------+
| `download_do`               | 验证用户的下载请求是否合法，传入的 token 将由当前用户进行解析，若失败则返 |
|                             | 回 403 错误；若成功则根据用户请求反馈数据，当用户试图下载的是目录时，会先 |
|                             | 将目录压缩为压缩包后反馈给用户，否则直接返回文件                          |
+-----------------------------+---------------------------------------------------------------------------+
| `newfolder`                 | 为用户创建目录提供了入口，用户可在云盘界面、复制、移动、Fork 的同时创建新 |
|                             | 文件夹                                                                    |
+-----------------------------+---------------------------------------------------------------------------+
| `delete_message`            | 为用户提供了删除聊天消息的入口，一条聊天消息的接收/发送方均可删除消息，但 |
|                             | 删除操作仅限于从个人的视野中移除，对另一方并不产生影响。其效果与 WeChat 的|
|                             | 聊天记录删除相同。                                                        |
+-----------------------------+---------------------------------------------------------------------------+
| `recall_message`            | 为用户提供了发送消息撤回功能，功能与 QQ 的消息撤回相同，超过 2 分钟的消息 |
|                             | 无法撤回。2 分钟以内，无论对方是否已读均可撤回。撤回操作不可逆，消息将从数|
|                             | 据库中移除。                                                              |
+-----------------------------+---------------------------------------------------------------------------+
| `chat`                      | 提供了用户聊天入口                                                        |
+-----------------------------+---------------------------------------------------------------------------+
| `close_chat`                | 为用户提供了一次性忽略某个用户所有未读消息的功能                          | 
+-----------------------------+---------------------------------------------------------------------------+
| `delete_chat`               | 为用户提供了一次性删除某个用户所有聊天记录的功能                          | 
+-----------------------------+---------------------------------------------------------------------------+
| `set_share`                 | 为用户提供了设置文件共享属性的功能，提供了简单的设置密码界面              |
+-----------------------------+---------------------------------------------------------------------------+
| `set_private`               | set_share 的逆操作，将某个文件/目录及关联的目录/文件全部设为私有          |
+-----------------------------+---------------------------------------------------------------------------+


接下来请您阅读 :ref:`web-test` 。
